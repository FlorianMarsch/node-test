<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta
         http-equiv="x-ua-compatible"
         content="ie=edge">
      <title></title>
      <meta
         name="description"
         content="">
      <meta
         name="viewport"
         content="width=device-width, initial-scale=1">
      <!-- Angular Material style sheet -->
      <link
         rel="stylesheet"
         href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.css">
      <link
         rel="stylesheet"
         href="https://fonts.googleapis.com/icon?family=Material+Icons">
   </head>
   <body
      ng-app="myApp"
      ng-cloak>
      <!--
         Your HTML content here
         -->
      <div
         ng-controller="formCtrl"
         layout="column"
         ng-cloak
         class="md-inline-form">
         <md-toolbar class="md-accent">
            <div class="md-toolbar-tools">
               <h2 flex >Copa Online {{user.id ? gameday.season + ' ' + gameday.gameday +'. Spieltag' :''}}</h2>
               <div ng-hide="user.id">
                  <md-button href="/register" class=" md-primary md-raised" >
                     registrieren
                  </md-button>
               </div>
               <div  ng-show="user.id">
                  {{user.name}} , 
                  <a href="/signout">
                  logout
                  </a>
               </div>
            </div>
         </md-toolbar>
         <md-nav-bar
            ng-show="user.id"
            md-selected-nav-item="active"
            nav-bar-aria-label="navigation links">
            <md-nav-item md-nav-click="goto('news')" name="news">
               News
            </md-nav-item>
            <md-nav-item md-nav-click="goto('spielstand')" name="spielstand">
               Spielstand
            </md-nav-item>
            <md-nav-item md-nav-click="goto('aufstellung')" name="aufstellung">
               <md-icon ng-show="warning === true" >warning</md-icon>
               Aufstellung
            </md-nav-item>
            <md-nav-item md-nav-click="goto('transfermarkt')" name="transfermarkt">
               Transfermarkt
            </md-nav-item>
            <md-nav-item md-nav-click="goto('angebote')" name="angebote">
               Angebote
            </md-nav-item>
            <md-nav-item md-nav-click="goto('profile')" name="profile">
               Profile
            </md-nav-item>
         </md-nav-bar>
         <md-content
            layout-padding
            ng-show="active == 'loading'">
            <div
               layout="row"
               layout-sm="column"
               layout-align="space-around">
               <md-progress-circular md-mode="indeterminate"></md-progress-circular>
            </div>
         </md-content>
         <md-content
            layout-padding>
            <div
               ng-hide="user.id"
               layout="row"
               layout-sm="column"
               layout-align="space-around">
               <form action="/login" method="POST">
                  <md-card >
                     <md-card-title>
                        <md-card-title-text>
                           <span class="md-headline">Anmeldung</span>
                        </md-card-title-text>
                     </md-card-title>
                     <md-card-content>
                        <md-input-container>
                           <label>User</label>
                           <input name="username" value="Mickey" type="text">
                        </md-input-container>
                        <md-input-container>
                           <label>Password</label>
                           <input name="password" value="Mouse" type="password">
                        </md-input-container>
                     </md-card-content>
                     <md-card-actions layout="row" layout-align="end center">
                        <md-button type="submit" class=" md-primary md-raised">login</md-button>
                     </md-card-actions>
                  </md-card>
               </form>
            </div>
            <div
               layout="row"
            
               ng-show="active == 'news'">
              
               
                       <md-input-container  class="md-block" flex-gt-xs>
				        <label>Tippe eine Nachricht ein</label>
				        <input ng-model="createNews.message">
				      </md-input-container>
					<div>
					      <md-button  ng-click="submitNews">senden</md-button>
				    </div>
			</div>
			  <div
               layout="row"
               ng-show="active == 'news'">
               
               
                 <md-list flex>
			        <md-list-item class="md-2-line" ng-repeat="x in news" ng-click="null">
			          <div class="md-list-item-text" layout="column">
			            <h3>{{ x.username }} - {{ x.time }}</h3>
			            <h4>{{ x.message }}</h4>
			          </div>
			        </md-list-item>
              	</md-list>
                 
            </div>
         </md-content>
      </div>
      <!-- Angular Material requires Angular.js Libraries -->
      <script
         src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
      <script
         src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
      <script
         src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-aria.min.js"></script>
      <script
         src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-messages.min.js"></script>
      <script
         src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-route.js"></script>
      <!-- Angular Material Library -->
      <script
         src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.0/angular-material.min.js"></script>
      <!-- Your application bootstrap  -->
      <script type="text/javascript">
         /**
          * You must include the dependency on 'ngMaterial' 
          */
         var app = angular.module('myApp', [ 'ngMaterial' ]);
         
         app.controller('formCtrl', function($scope, $timeout, $http) {
         
         	var timeout = $timeout;
         	var scope = $scope;
         	var http = $http;
         	var me = this;
         
         	scope.active = 'loading';
         	scope.list = [];
         	scope.user = {'id':'<%= userId %>', 'name':'<%= userName %>'};
         	
         	scope.news=[];
         	scope.createNews={'message':''};
         	scope.loadNews = function(callback){
         			$http({
		         		method : 'GET',
		         		url : '/api/news',
		         		responseType : 'json'
		         	}).then(function(response) {
		         		scope.news=response;
		         		if(callback){
		         			callback();
		         		}
		         	},function(error) {
		         		console.log(error);
		         		if(callback){
		         			callback();
		         		}
		         	});
         		}
         	};
         	scope.submitNews = function(){
         		if(scope.createNews !== ''){
         			scope.active = 'loading';
         			$http({
		         		method : 'POST',
		         		url : '/api/news',
		         		responseType : 'json',
		         		body:JSON.stringfiy(scope.createNews)
		         	}).then(function(response) {
		         		loadNews(function(){
		         			scope.createNews='';
		         			scope.active = 'news';
		         		});
		         	},function(error) {
		         		console.log(error);
		         	});
         		}
         	};
         
         	if(scope.user.id){
	         	$http({
	         		method : 'GET',
	         		url : '/api/currentResults',
	         		responseType : 'json'
	         	}).then(function(response) {
	         		$scope.gameday = response.data;
	         		if($scope.gameday.results.length === 0){
	         			$scope.active = 'news';
	         		}else{
	         			$scope.active = 'spielstand';
	         		}
	         		
	         	},function(error) {
	         		console.log(error);
	         	});
         	}else{
         		$scope.active = 'choose';
         	}
         });
      </script>
   </body>
</html>